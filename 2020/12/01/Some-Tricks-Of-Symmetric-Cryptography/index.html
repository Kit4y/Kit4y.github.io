<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>Some Tricks of Symmetric Cryptography - ShuYu</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="他浑身都是弱点，简直一无是处，但他靠着自己的力量一步步克服，最终成为了火影">





    <meta name="description" content="Symmetric Cryptography means this encryption algorithm use the same key for encryption and decryption. Although I am a web dog, encryption algorithm in some web question recently let me broken heart.">
<meta property="og:type" content="article">
<meta property="og:title" content="Some Tricks of Symmetric Cryptography">
<meta property="og:url" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/index.html">
<meta property="og:site_name" content="ShuYu">
<meta property="og:description" content="Symmetric Cryptography means this encryption algorithm use the same key for encryption and decryption. Although I am a web dog, encryption algorithm in some web question recently let me broken heart.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/1.png">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/2.png">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/3.png">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/4.png">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/1.jpg">
<meta property="og:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/5.png">
<meta property="article:published_time" content="2020-12-01T06:05:08.000Z">
<meta property="article:modified_time" content="2020-12-09T21:10:50.016Z">
<meta property="article:author" content="ShuYu">
<meta property="article:tag" content="crypto">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2020/12/01/Some-Tricks-Of-Symmetric-Cryptography/1.png">





<link rel="icon" href="/images/logo.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css">


<link rel="stylesheet" href="../../../../css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
    
    
    
    

    


<meta name="generator" content="Hexo 5.2.0"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="../../../../index.html">
                
                <img src="../../../../images/logo.png" alt="" height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="../../../../archives">Archives</a>
            
            <a class="navbar-item "
               href="../../../../friends">Friends</a>
            
            <a class="navbar-item "
               href="../../../../about">About</a>
            
            <a class="navbar-item "
               href="../../../../tags">Tags</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" title="GitHub" target="_blank" rel="noopener" href="https://github.com/bkfish">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Some Tricks of Symmetric Cryptography
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2020-12-01T06:05:08.000Z" itemprop="datePublished">Dec 1 2020</time>
            
        </span>
        
        
        <span class="column is-narrow">
            
            
            15 minutes read (About 2207 words)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><p>Symmetric Cryptography means this encryption algorithm use the same key for encryption and decryption. Although I am a web dog, encryption algorithm in some web question recently let me broken heart.</p>
<a id="more"></a>

<!-- toc -->

<ul>
<li><a href="#1-some-symmetric-encryption-algorithm">1. Some Symmetric Encryption Algorithm</a></li>
<li><a href="#2-symmetric-cryptography-in-ctf-web">2. Symmetric Cryptography in CTF-WEB</a></li>
<li><a href="#3-some-encryption-mode">3. Some Encryption mode</a><ul>
<li><a href="#31-electronic-codebook-book-ecb">3.1. Electronic Codebook Book (ECB)</a></li>
<li><a href="#32-cipher-block-chaining-cbc">3.2. Cipher Block Chaining (CBC)</a></li>
</ul>
</li>
<li><a href="#4cbc-byte-flipping-attack">4.CBC Byte Flipping Attack</a><ul>
<li><a href="#41working-principle">4.1.Working Principle</a></li>
<li><a href="#42for-example-if-we-can-change-iv">4.2.For example if we can change iv</a><ul>
<li><a href="#421question-of-only-change-iv">4.2.1.Question of only change iv</a></li>
</ul>
</li>
<li><a href="#43change-cipheriv">4.3.change cipher&amp;&amp;iv</a></li>
</ul>
</li>
<li><a href="#5cbc-padding-oracle">5.CBC Padding Oracle</a><ul>
<li><a href="#51q">5.1.Q</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h2><span id="1-some-symmetric-encryption-algorithm">1. Some Symmetric Encryption Algorithm</span></h2><p>DES&#x3001;3DES&#x3001;TDEA&#x3001;Blowfish&#x3001;RC2&#x3001;RC4&#x3001;RC5&#x3001;IDEA&#x3001;SKIPJACK</p>
<p>Here is another blog for <a href="/2019/08/16/S-DES%E8%AF%A6%E8%A7%A3/">S-DES</a> which i wrote before.</p>
<h2><span id="2-symmetric-cryptography-in-ctf-web">2. Symmetric Cryptography in CTF-WEB</span></h2><p>here are some crypto in ctf.which i know most is Padding Oracle or Cbc Flipped Ciphertext Bits.<br>for example CBC in NJCTF or <a target="_blank" rel="noopener" href="http://ctf5.shiyanbar.com/web/jiandan/test.php">shiyanba easy login question</a> and so on . some i want introduce some Padding Oracle Tricks in ctf_web.</p>
<h2><span id="3-some-encryption-mode">3. Some Encryption mode</span></h2><p>Symmetric encryption has two types of encryption modes, namely block encryption and stream encryption.but in AES algorithm has five modes.if you want to find a aes decrypto/encrypto online mabey you need choice which mode you want use.<br>for example<br><img src="1.png"></p>
<blockquote>
<p>Electronic Codebook Book (ECB)<br>Cipher Block Chaining (CBC)<br>Counter (CTR)<br>Cipher FeedBack (CFB)<br>Output FeedBack (OFB)</p>
</blockquote>
<h3><span id="31-electronic-codebook-book-ecb">3.1. Electronic Codebook Book (ECB)</span></h3><p>ECB is the simplest mode is encryption modes.<br><img src="2.png"><br>As we can see,we just need block the plaintext.Encryto every piece,than split joint every ciphertext.this is ECB encryption mode.</p>
<h3><span id="32-cipher-block-chaining-cbc">3.2. Cipher Block Chaining (CBC)</span></h3><p>In this mode, the plaintext is first divided into several segments, and then each segment is XOR with the initial block(first segments) or the ciphertext segment of the previous segment, and then encrypted with the key.<br><img src="3.png"><br>Explain this encryption flow chart:<br>&#x2022; Ciphertext-0 = Encrypt(Plaintext XOR IV)&#x2014;for first plaintext segment<br>&#x2022; Ciphertext-N= Encrypt(Plaintext XOR Ciphertext-N-1)&#x2014;othere plaintext segments<br>Decyption as same.<br><img src="4.png"><br>&#x2022;Plaintext-0 = Decrypt(Ciphertext XOR IV) &#x2014;for first ciphertext segment<br>&#x2022;Plaintext-N= Decrypt(Ciphertext XOR Ciphertext-N-1)&#x2014;othere ciphertext segments</p>
<h2><span id="4cbc-byte-flipping-attack">4.CBC Byte Flipping Attack</span></h2><p>Purpose of CBC Byte Flipping Attack:To change a byte in the plaintext by corrupting a byte in the ciphertext.</p>
<h3><span id="41working-principle">4.1.Working Principle</span></h3><p>Note: The Ciphertext-N-1 is used to generate the plaintext of the next block; this is where the byte flipping attack comes into play. If we change one byte of the Ciphertext-N-1 then, by XORing with the net decrypted block, we will get a different plaintext! You got it? Do not worry, we will see a detailed example below. Meanwhile, below is a nice diagram explaining this attack<br><img src="1.jpg"><br>And this is we know in math</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="code"><pre><code class="hljs plain">Now_Plantext(A) = Now_Ciphertext(B) ^ Last_Ciphertext(C)<br>A = B ^ C<br>A ^ A = 0;   0 ^ A = A<br>C = A ^ A ^ C = B ^ C ^ A ^ C = A ^ B<br>ascii(&apos;a&apos;) ^ C ^ A ^ B = ascii(&apos;a&apos;) ^ A ^ B ^ A ^ B = ascii(&apos;a&apos;) ^ 0 = ascii(&apos;a&apos;)<br></code></pre></td></tr></tbody></table></figure>
<p>so if we want let answer become &#x201C;a&#x201D;,we just need <code> Last_Ciphertext ^ Now_Plantext ^ Now_Ciphertext ^ &quot;A&quot;</code></p>
<h3><span id="42for-example-if-we-can-change-iv">4.2.For example if we can change iv</span></h3><figure class="highlight plain hljs"><table><tbody><tr><td class="code"><pre><code class="hljs plain">KEY = &apos;mHAxsLYz&apos;<br>vi = &quot;qwerasdf&quot;<br>admin-&gt;bdmin<br></code></pre></td></tr></tbody></table></figure>
<p>This env len(vi==Key),so we just need <code> new_cipher=bytes([ord(chr(cipher[0]))^ord(&apos;a&apos;)^ord(&apos;b&apos;)])+cipher[1:]</code></p>
<figure class="highlight python hljs"><table><tbody><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pyDes <span class="hljs-keyword">import</span> des, CBC, PAD_PKCS5<br><span class="hljs-keyword">import</span> binascii<br><br>KEY = <span class="hljs-string">&apos;mHAxsLYz&apos;</span><br>vi = <span class="hljs-string">&quot;qwerasdf&quot;</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">des_encrypt</span>(<span class="hljs-params">s</span>):</span><br>    secret_key = KEY<br>    iv = vi<br>    k = des(secret_key, CBC, iv, pad=<span class="hljs-literal">None</span>, padmode=PAD_PKCS5)<br>    en = k.encrypt(s, padmode=PAD_PKCS5)<br>    <span class="hljs-keyword">return</span> binascii.b2a_hex(en)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">des_descrypt</span>(<span class="hljs-params">s,iv</span>):</span><br>    secret_key = KEY<br>    iv = iv<br>    k = des(secret_key, CBC, iv, pad=<span class="hljs-literal">None</span>, padmode=PAD_PKCS5)<br>    de = k.decrypt(binascii.a2b_hex(s), padmode=PAD_PKCS5)<br>    <span class="hljs-keyword">return</span> de<br><br><span class="hljs-built_in">str</span> = des_encrypt(<span class="hljs-string">&quot;admin&quot;</span>)<br>cipher = <span class="hljs-built_in">bytes</span>(vi,encoding=<span class="hljs-string">&apos;utf-8&apos;</span>)<br>print(cipher)<br>x = <span class="hljs-built_in">bytes</span>([<span class="hljs-built_in">ord</span>(<span class="hljs-built_in">chr</span>(cipher[<span class="hljs-number">0</span>]))^<span class="hljs-built_in">ord</span>(<span class="hljs-string">&apos;a&apos;</span>)^<span class="hljs-built_in">ord</span>(<span class="hljs-string">&apos;b&apos;</span>)])+cipher[<span class="hljs-number">1</span>:]<br>print(x)<br>str3 = des_descrypt(<span class="hljs-built_in">str</span>,x)<br>print(str3)<br></code></pre></td></tr></tbody></table></figure>
<p><img src="5.png"><br>In php we use those func for cbc</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="code"><pre><code class="hljs plain">openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);<br>openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)<br></code></pre></td></tr></tbody></table></figure>
<h4><span id="421question-of-only-change-iv">4.2.1.Question of only change iv</span></h4><p>source_code</p>
<figure class="highlight php hljs"><table><tbody><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>error_reporting(<span class="hljs-number">0</span>);<br>define(<span class="hljs-string">&quot;METHOD&quot;</span>, <span class="hljs-string">&quot;aes-128-cbc&quot;</span>);<br>define(<span class="hljs-string">&quot;SECRET_KEY&quot;</span>, <span class="hljs-string">&quot;XXXXX&quot;</span>);<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag{this_is_flag}&quot;</span>;<br>session_start();<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_random_token</span>(<span class="hljs-params"></span>)</span>{<br>    <span class="hljs-variable">$random_token</span>=<span class="hljs-string">&apos;&apos;</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-number">16</span>;<span class="hljs-variable">$i</span>++){<br>        <span class="hljs-variable">$random_token</span>.=chr(rand(<span class="hljs-number">1</span>,<span class="hljs-number">255</span>));<br>    }<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$random_token</span>;<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_identity</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>{<br> <span class="hljs-variable">$defaultID</span> = <span class="hljs-string">&quot;heheda&quot;</span>;<br> <span class="hljs-variable">$token</span> = get_random_token();<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&apos;id&apos;</span>] = base64_encode(openssl_encrypt(<span class="hljs-variable">$defaultID</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="hljs-variable">$token</span>));<br>    setcookie(<span class="hljs-string">&quot;token&quot;</span>, base64_encode(<span class="hljs-variable">$token</span>));<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&apos;isadmin&apos;</span>] = <span class="hljs-literal">false</span>;<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_admin</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>{<br> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&apos;id&apos;</span>])){<br>  <span class="hljs-variable">$token</span> = base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&apos;token&apos;</span>]);<br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable">$id</span> = openssl_decrypt(base64_decode(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&apos;id&apos;</span>]), METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="hljs-variable">$token</span>)){<br>   <span class="hljs-keyword">if</span>(<span class="hljs-variable">$id</span> == <span class="hljs-string">&quot;admin&quot;</span>)<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&apos;isadmin&apos;</span>] = <span class="hljs-literal">true</span>;<br>  } <span class="hljs-keyword">else</span> {<br>   <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Error!&quot;</span>);<br>  }<br> }<br>}<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&apos;id&apos;</span>]))<br>    get_identity();<br><span class="hljs-keyword">else</span> {<br> is_admin();<br> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;isadmin&quot;</span>]){<br>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are admin!\n&quot;</span>;<br>     <span class="hljs-keyword">die</span>(<span class="hljs-variable">$flag</span>);<br> }<span class="hljs-keyword">else</span><br>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are not admin!\n&quot;</span>;<br>}<br> <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>exp1 for py2</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><span class="hljs-keyword">import</span> base64 <span class="hljs-keyword">as</span> b64<br><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">import</span> requests<br><br>source_str = <span class="hljs-string">&apos;heheda&apos;</span> + <span class="hljs-number">10</span> * <span class="hljs-string">&apos;\x0a&apos;</span><br>target_srt = <span class="hljs-string">&apos;admin&apos;</span> + <span class="hljs-number">11</span> * <span class="hljs-string">&apos;\x0b&apos;</span><br>token = <span class="hljs-string">&apos;eANhyUAiu6jfkh5CvDnkpQ==&apos;</span> <span class="hljs-comment">#you got token</span><br>token = <span class="hljs-built_in">list</span>(b64.b64decode(token))<br><span class="hljs-comment">#print(token)</span><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(target_srt)):<br>    token[x] = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(token[x]) ^ <span class="hljs-built_in">ord</span>(target_srt[x]) ^ <span class="hljs-built_in">ord</span>(source_str[x]))<br><span class="hljs-built_in">print</span> token<br><span class="hljs-built_in">print</span> b64.b64encode(<span class="hljs-string">&apos;&apos;</span>.join(token))<br></code></pre></td></tr></tbody></table></figure>
<p>exp2 for py3</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><span class="hljs-keyword">import</span> base64 <span class="hljs-keyword">as</span> b64<br><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">import</span> requests<br><br>source_str = <span class="hljs-string">&apos;heheda&apos;</span> + <span class="hljs-number">10</span> * <span class="hljs-string">&apos;\x0a&apos;</span><br>target_srt = <span class="hljs-string">&apos;admin&apos;</span> + <span class="hljs-number">11</span> * <span class="hljs-string">&apos;\x0b&apos;</span><br>token = <span class="hljs-string">&apos;yxC20Pw32gbpCPjLc5qNRw==&apos;</span> <span class="hljs-comment">#you got token</span><br>token = <span class="hljs-built_in">bytearray</span>(b64.b64decode(token))<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(target_srt)):<br>    token[x] = token[x] ^ <span class="hljs-built_in">ord</span>(target_srt[x]) ^ <span class="hljs-built_in">ord</span>(source_str[x])<br>print(b64.b64encode(token))<br><br><span class="hljs-comment">#cQJkxUpIuqnekx9DvTjlpA==</span><br></code></pre></td></tr></tbody></table></figure>

<h3><span id="43change-cipherampampiv">4.3.change cipher&amp;&amp;iv</span></h3><figure class="highlight python hljs"><table><tbody><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> b2a_hex,a2b_hex<br>key=<span class="hljs-string">&quot;1234567890123456&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encrypt</span>(<span class="hljs-params">iv,plaintext</span>):</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(plaintext)%<span class="hljs-number">16</span> != <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;plaintext length is invalid&quot;</span><br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(iv) != <span class="hljs-number">16</span>:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;IV length is invalid&quot;</span><br>        <span class="hljs-keyword">return</span><br>    aes_encrypt = AES.new(key,AES.MODE_CBC,IV=iv)<br>    <span class="hljs-keyword">return</span> b2a_hex(aes_encrypt.encrypt(plaintext))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decrypt</span>(<span class="hljs-params">iv,cipher</span>):</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(iv) != <span class="hljs-number">16</span>:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;IV length is invalid&quot;</span><br>        <span class="hljs-keyword">return</span><br>    aes_decrypt = AES.new(key,AES.MODE_CBC,IV=iv)<br>    <span class="hljs-keyword">return</span> b2a_hex(aes_decrypt.decrypt(a2b_hex(cipher)))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span>():</span><br>    iv=<span class="hljs-string">&quot;ABCDEFGH12345678&quot;</span><br>    plaintext=<span class="hljs-string">&quot;0123456789ABCDEFhelloyoucgetflag&quot;</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;plaintext:&quot;</span>+plaintext<br>    cipher=encrypt(iv, plaintext)<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;cipher:&quot;</span>+cipher<br>    de_cipher = decrypt(iv, cipher)<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;de_cipher:&quot;</span>+de_cipher<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;de_cipher:&quot;</span>+a2b_hex(de_cipher)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_cbc_15</span>():</span><br>    iv=<span class="hljs-string">&quot;ABCDEFGH12345678&quot;</span><br>    plaintext=<span class="hljs-string">&quot;0123456789ABCDEFhelloyoucgetflag&quot;</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;plaintext:&quot;</span>+plaintext<br>    cipher=encrypt(iv, plaintext)<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;cipher:&quot;</span>+cipher<br>    bin_cipher = <span class="hljs-built_in">bytearray</span>(a2b_hex(cipher))<br>    bin_cipher[<span class="hljs-number">15</span>] = bin_cipher[<span class="hljs-number">15</span>] ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&apos;g&apos;</span>) ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&apos;G&apos;</span>)<br>    de_cipher = decrypt(iv,b2a_hex(bin_cipher))<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;de_cipher2:&quot;</span>+de_cipher<br>    <span class="hljs-built_in">print</span> a2b_hex(de_cipher)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_cbc_all</span>():</span><br>    iv=<span class="hljs-string">&quot;ABCDEFGH12345678&quot;</span><br>    plaintext=<span class="hljs-string">&quot;0123456789ABCDEFhelloyoucgetflag&quot;</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;plaintext:&quot;</span>+plaintext<br>    cipher=encrypt(iv, plaintext)<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;cipher:&quot;</span>+cipher<br>    bin_cipher = <span class="hljs-built_in">bytearray</span>(a2b_hex(cipher))<br>    bin_cipher[<span class="hljs-number">15</span>] = bin_cipher[<span class="hljs-number">15</span>] ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&apos;g&apos;</span>) ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&apos;1&apos;</span>)<br>    de_cipher = decrypt(iv,b2a_hex(bin_cipher))<br>    bin_decipher = <span class="hljs-built_in">bytearray</span>(a2b_hex(de_cipher))<br>    bin_iv = <span class="hljs-built_in">bytearray</span>(iv)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(iv)):<br>        bin_iv[i] = bin_iv[i] ^ bin_decipher[i] ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&apos;X&apos;</span>)<br>    de_cipher = decrypt(<span class="hljs-built_in">str</span>(bin_iv),b2a_hex(bin_cipher))<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;de_cipher3:&quot;</span>+de_cipher<br>    <span class="hljs-built_in">print</span> a2b_hex(de_cipher)<br>test_cbc_all();<br></code></pre></td></tr></tbody></table></figure>

<h2><span id="5cbc-padding-oracle">5.CBC Padding Oracle</span></h2><h3><span id="51q">5.1.Q</span></h3><p>padding_serv.py</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="code"><pre><code class="hljs python"><span class="hljs-string">&apos;&apos;&apos;</span><br><span class="hljs-string">This server is a modified version of the previous one.</span><br><span class="hljs-string">This server will send you some data encrypted in CBC mode.</span><br><span class="hljs-string">You can request decryptions of ciphertexts. The server will tell you if your ciphertext</span><br><span class="hljs-string">decrypts to something with valid padding, but you won&apos;t get the plaintext back.</span><br><span class="hljs-string">This is one of those obscure crypto implementation details that you can use to completely </span><br><span class="hljs-string">defeat the cryptosystem.</span><br><span class="hljs-string">The Secret is in the decrypted ciphertext. </span><br><span class="hljs-string">Good luck!</span><br><span class="hljs-string">Ciphertexts are sent back and forth as ASCII Encoded Hex Strings. 0xFF will be sent as </span><br><span class="hljs-string">&quot;FF&quot; (2 Bytes), not as &quot;\xff&quot; (1 Byte).</span><br><span class="hljs-string">You can use python&apos;s string.encode(&apos;hex&apos;) and string.decode(&apos;hex&apos;) to quickly convert between</span><br><span class="hljs-string">raw data and string representation if you need/want to.</span><br><span class="hljs-string">Email biernp@rpi.edu with questions/comments :)</span><br><span class="hljs-string">-Patrick Biernat</span><br><span class="hljs-string">&apos;&apos;&apos;</span><br><br><span class="hljs-keyword">from</span> twisted.internet <span class="hljs-keyword">import</span> reactor, protocol<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> random<br><br>PORT = <span class="hljs-number">9004</span><br><br>KEYSIZE = <span class="hljs-number">16</span><br>KEY = <span class="hljs-string">&quot;AAA&quot;</span> + <span class="hljs-string">&quot;BBB&quot;</span> + <span class="hljs-string">&quot;CCC&quot;</span> + <span class="hljs-string">&apos;\x01&apos;</span> + <span class="hljs-string">&quot;\x80&quot;</span> * <span class="hljs-number">6</span><br>IV = os.urandom(<span class="hljs-number">16</span>)<br>SECRET = <span class="hljs-string">&quot;A&quot;</span> * <span class="hljs-number">16</span> + <span class="hljs-string">&quot;d4t_!nf0_l34k_y0&quot;</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pad</span>(<span class="hljs-params">instr, length</span>):</span><br>        <span class="hljs-string">&apos;&apos;&apos;</span><br><span class="hljs-string">	Generate valid PKCS#7 Padding</span><br><span class="hljs-string">	&apos;&apos;&apos;</span><br>	<span class="hljs-keyword">if</span>(length == <span class="hljs-literal">None</span>):<br>                <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Supply a length to pad to&quot;</span><br>        <span class="hljs-keyword">elif</span>(<span class="hljs-built_in">len</span>(instr) &lt; length):<br>                <span class="hljs-keyword">return</span> instr + <span class="hljs-built_in">chr</span>((length - <span class="hljs-built_in">len</span>(instr))) * (length - <span class="hljs-built_in">len</span>(instr))<br>        <span class="hljs-keyword">elif</span>(<span class="hljs-built_in">len</span>(instr) % length == <span class="hljs-number">0</span>):<br>                <span class="hljs-comment">#Add a block-length worth of padding. </span><br>                <span class="hljs-keyword">return</span> instr + (<span class="hljs-built_in">chr</span>(length) * length)<br>        <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> instr + <span class="hljs-built_in">chr</span>((length - (<span class="hljs-built_in">len</span>(instr) % length ))) * (length - (<span class="hljs-built_in">len</span>(instr) % length ))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">valid_padding</span>(<span class="hljs-params">instr</span>):</span><br>        <span class="hljs-string">&apos;&apos;&apos;</span><br><span class="hljs-string">        Determine if valid PKCS#7 Padding is present in instr.</span><br><span class="hljs-string">        &apos;&apos;&apos;</span><br>        <span class="hljs-comment">#Grab the last byte of instr.</span><br>        length = instr[-<span class="hljs-number">1</span>]<br><span class="hljs-comment">#       print length.encode(&apos;hex&apos;)</span><br>        test = instr[-<span class="hljs-number">1</span> * <span class="hljs-built_in">int</span>(length.encode(<span class="hljs-string">&apos;hex&apos;</span>),<span class="hljs-number">16</span>):]<br>        test = test.replace(length,<span class="hljs-string">&quot;&quot;</span>)<br>        <span class="hljs-keyword">if</span> (test != <span class="hljs-string">&quot;&quot;</span>):<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encrypt_block</span>(<span class="hljs-params">key, plaintext</span>):</span><br>        encobj = AES.new(key, AES.MODE_ECB)<br>        <span class="hljs-keyword">return</span> encobj.encrypt(plaintext).encode(<span class="hljs-string">&apos;hex&apos;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decrypt_block</span>(<span class="hljs-params">key, ctxt</span>):</span><br>        decobj = AES.new(key, AES.MODE_ECB)<br>        <span class="hljs-keyword">return</span> decobj.decrypt(ctxt).encode(<span class="hljs-string">&apos;hex&apos;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">xor_block</span>(<span class="hljs-params">first,second</span>):</span><br>        <span class="hljs-string">&apos;&apos;&apos;</span><br><span class="hljs-string">        Return a string containing a XOR of bytes in first with second</span><br><span class="hljs-string">        &apos;&apos;&apos;</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(first) != <span class="hljs-built_in">len</span>(second)):<br>                <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Blocks need to be the same length!&quot;</span><br>                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br><br>        first = <span class="hljs-built_in">list</span>(first)<br>        second = <span class="hljs-built_in">list</span>(second)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(first)):<br>                first[i] = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(first[i]) ^ <span class="hljs-built_in">ord</span>(second[i]))<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;&apos;</span>.join(first)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encrypt_cbc</span>(<span class="hljs-params">key,IV, plaintext</span>):</span><br>        <span class="hljs-string">&apos;&apos;&apos;</span><br><span class="hljs-string">        High Level Function to encrypt things in AES CBC Mode.</span><br><span class="hljs-string">        1: Pad plaintext if necessary. </span><br><span class="hljs-string">        2: Split plaintext into blocks of length &lt;keysize&gt;</span><br><span class="hljs-string">        3: XOR Block 1 w/ IV</span><br><span class="hljs-string">        4: Encrypt Blocks, XOR-ing them w/ the previous block. </span><br><span class="hljs-string">        &apos;&apos;&apos;</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(plaintext) % <span class="hljs-built_in">len</span>(key) != <span class="hljs-number">0</span>):<br>                plaintext = pad(plaintext,<span class="hljs-built_in">len</span>(key))<br>        blocks = [plaintext[x:x+<span class="hljs-built_in">len</span>(key)] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(plaintext),<span class="hljs-built_in">len</span>(key))]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(blocks)):<br>                <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>):<br>                        ctxt = xor_block(blocks[i],<span class="hljs-string">&quot;\x00&quot;</span>* <span class="hljs-number">16</span>)<br>                        ctxt = encrypt_block(key,ctxt)<br>                <span class="hljs-keyword">else</span>:<br>                        tmp = xor_block(blocks[i],ctxt[-<span class="hljs-number">1</span> * (<span class="hljs-built_in">len</span>(key) * <span class="hljs-number">2</span>):].decode(<span class="hljs-string">&apos;hex&apos;</span>))     <span class="hljs-comment">#len(key) * 2 because ctxt is an ASCII string that we convert to &quot;raw&quot; binary.          </span><br><br>                        ctxt = ctxt + encrypt_block(key,tmp)<br>        <span class="hljs-keyword">return</span> ctxt<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decrypt_cbc</span>(<span class="hljs-params">key,IV,ctxt</span>):</span><br>        <span class="hljs-string">&apos;&apos;&apos;High Level function to decrypt thins in AES CBC mode.</span><br><span class="hljs-string">        1: Split Ciphertext into blocks of len(Key)</span><br><span class="hljs-string">        2: Decrypt block.</span><br><span class="hljs-string">        3: For the first block, xor w/ IV. For the others, xor with last ciphertext block.</span><br><span class="hljs-string">        &apos;&apos;&apos;</span><br>        ctxt = ctxt.decode(<span class="hljs-string">&apos;hex&apos;</span>)<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(ctxt) % <span class="hljs-built_in">len</span>(key) != <span class="hljs-number">0</span>):<br>                <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Invalid Key.&quot;</span><br>                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>        blocks = [ctxt[x:x+<span class="hljs-built_in">len</span>(key)] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(ctxt),<span class="hljs-built_in">len</span>(key))]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(blocks)):<br>                <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>):<br>                        ptxt = decrypt_block(key,blocks[i])<br>                        ptxt = xor_block(ptxt.decode(<span class="hljs-string">&apos;hex&apos;</span>),IV)<br>                <span class="hljs-keyword">else</span>:<br>                        tmp = decrypt_block(key,blocks[i])<br>                        tmp = xor_block(tmp.decode(<span class="hljs-string">&apos;hex&apos;</span>),blocks[i-<span class="hljs-number">1</span>])<br>                        ptxt = ptxt + tmp<br>        <span class="hljs-keyword">return</span> ptxt<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">padding_check</span>(<span class="hljs-params">data</span>):</span><br>	<span class="hljs-built_in">print</span> <span class="hljs-string">&quot;DATA:&quot;</span><br>	<span class="hljs-built_in">print</span> data	<br>	<span class="hljs-built_in">print</span> decrypt_cbc(KEY,IV,data)<br>	<span class="hljs-keyword">return</span> valid_padding(decrypt_cbc(KEY,IV,data))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_your_ctxt</span>():</span><br>	<span class="hljs-string">&apos;&apos;&apos;</span><br><span class="hljs-string">	This will return the Secret String that you need to decrypt.</span><br><span class="hljs-string">	&apos;&apos;&apos;</span><br>	<span class="hljs-keyword">return</span> encrypt_cbc(KEY,IV,pad(SECRET,<span class="hljs-built_in">len</span>(KEY)))<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServer</span>(<span class="hljs-params">protocol.Protocol</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dataReceived</span>(<span class="hljs-params">self,data</span>):</span><br>	<span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(data) &gt; <span class="hljs-number">512</span>):<br>		self.transport.write(<span class="hljs-string">&quot;Data too long.\n&quot;</span>)<br>		self.transport.loseConnection()<br>		<span class="hljs-keyword">return</span><br><span class="hljs-comment">#Make Profile From &quot;Email&quot;</span><br>	<span class="hljs-keyword">if</span>(data.startswith(<span class="hljs-string">&quot;get:&quot;</span>)):<br>		resp = get_your_ctxt()<br>		<span class="hljs-keyword">if</span> (resp == -<span class="hljs-number">1</span>):<br>			self.transport.write(<span class="hljs-string">&quot;No Cheating!\n&quot;</span>)<br>		<span class="hljs-keyword">else</span>:<br>			self.transport.write(resp)<br><br><span class="hljs-comment">#Decrypt Ciphertext and &quot;parse&quot; into Profile</span><br>	<span class="hljs-keyword">elif</span>(data.startswith(<span class="hljs-string">&quot;parse:&quot;</span>)):<br>		<span class="hljs-built_in">print</span> <span class="hljs-string">&quot;PARSING&quot;</span><br>		data = data[<span class="hljs-number">6</span>:]<br>		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">len</span>(data) % KEYSIZE != <span class="hljs-number">0</span>):<br>			<span class="hljs-built_in">print</span> <span class="hljs-string">&quot;BAD CIPHERTEXT&quot;</span><br>			self.transport.write(<span class="hljs-string">&quot;Invalid Ciphertext &lt;length&gt;\n&quot;</span>)<br>			self.transport.loseConnection()<br>			<span class="hljs-keyword">return</span><br>		<br>		<span class="hljs-keyword">if</span>(padding_check(data) == <span class="hljs-literal">True</span>):<br>			self.transport.write(<span class="hljs-string">&quot;VALID PADDING&quot;</span>)<br>		<br>		<span class="hljs-keyword">else</span>:<br>			self.transport.write(<span class="hljs-string">&quot;INVALID PADDING&quot;</span>)<br>	<br>	<span class="hljs-keyword">else</span>:<br>		self.transport.write(<span class="hljs-string">&quot;Syntax Error&quot;</span>)<br>		self.transport.loseConnection()<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServerFactory</span>(<span class="hljs-params">protocol.Factory</span>):</span><br>    protocol = MyServer<br><br><br><br>factory = MyServerFactory()<br>reactor.listenTCP(PORT, factory)<br>reactor.run()<br></code></pre></td></tr></tbody></table></figure>
<p>exp</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">str2num</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(s.encode(<span class="hljs-string">&apos;hex&apos;</span>),<span class="hljs-number">16</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">num2str</span>(<span class="hljs-params">n</span>):</span><br>    d = (<span class="hljs-string">&apos;%x&apos;</span> % n)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(d) % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>:<br>        d = <span class="hljs-string">&apos;0&apos;</span> + d<br>    <span class="hljs-keyword">return</span> d<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">func</span>(<span class="hljs-params">j,z</span>):</span><br>    x = <span class="hljs-string">&quot;00&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">255</span>):<br>        y = <span class="hljs-string">&quot;parse:&quot;</span>+<span class="hljs-string">&quot;00&quot;</span>*j + x + z+<span class="hljs-string">&quot;ef2c6db9d0bc134f752a119899160b72&quot;</span><br>        client.send(y)<br>        data = client.recv(<span class="hljs-number">1024</span>)<br>        <span class="hljs-keyword">if</span> data == <span class="hljs-string">&quot;VALID PADDING&quot;</span>:<br>           <span class="hljs-comment"># print i, hex(i)</span><br>            <span class="hljs-keyword">return</span> i<br>        x = <span class="hljs-built_in">int</span>(x, <span class="hljs-number">16</span>) + <span class="hljs-number">1</span><br>        x = num2str(x)<br><br>client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>client.connect((<span class="hljs-string">&apos;127.0.0.1&apos;</span>, <span class="hljs-number">9004</span>))<br><br>client.send(<span class="hljs-string">&quot;get:AAAAAAA&quot;</span>)<br>data = client.recv(<span class="hljs-number">1024</span>)<br><span class="hljs-built_in">print</span> data<br><br>client.send(<span class="hljs-string">&quot;parse:f9b6e7556dd0fa9038ac346e849cc5c1ef2c6db9d0bc134f752a119899160b7217a36290f3ed054ca48f1b052578b644&quot;</span>)<br>data = client.recv(<span class="hljs-number">1024</span>)<br><span class="hljs-built_in">print</span> data<br><br><span class="hljs-built_in">sum</span> = <span class="hljs-number">16</span><br>j = <span class="hljs-number">15</span><br>k = <span class="hljs-number">1</span><br>tmp = <span class="hljs-string">&quot;01&quot;</span> <span class="hljs-comment"># from 1 to \x10</span><br>string_s = <span class="hljs-string">&quot;&quot;</span><br>string_mid = <span class="hljs-string">&quot;&quot;</span><br>z = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">while</span>(<span class="hljs-built_in">sum</span>):<br>    confir = num2str(func(j,z))<br>   <span class="hljs-comment"># print confir</span><br>    string_s = <span class="hljs-built_in">str</span>(confir) <br>    <span class="hljs-comment">#print &quot;string_s:&quot;+string_s</span><br>    <span class="hljs-comment">#print &quot;string_mid:&quot;+string_mid</span><br>    <span class="hljs-comment">#print tmp*k</span><br>    string_mid = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(string_s,<span class="hljs-number">16</span>)^<span class="hljs-built_in">int</span>(tmp,<span class="hljs-number">16</span>)))+string_mid<br><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;string_mid:&quot;</span> + string_mid<br>    tmp = <span class="hljs-built_in">int</span>(tmp, <span class="hljs-number">16</span>) + <span class="hljs-number">1</span><br>    tmp = num2str(tmp)<br>    string_mid = string_mid[<span class="hljs-number">2</span>:].replace(<span class="hljs-string">&apos;L&apos;</span>,<span class="hljs-string">&apos;&apos;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(string_mid)%<span class="hljs-number">2</span> !=<span class="hljs-number">0</span>:<br>    string_mid = <span class="hljs-string">&quot;0&quot;</span>+string_mid<br>    <span class="hljs-comment">#print string_mid</span><br>    <span class="hljs-comment">#print tmp</span><br>    temp = <span class="hljs-built_in">len</span>(z)+<span class="hljs-number">3</span><br><br>    z = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(string_mid,<span class="hljs-number">16</span>)^<span class="hljs-built_in">int</span>(tmp*k,<span class="hljs-number">16</span>)))<br>    z = z[<span class="hljs-number">2</span>:].replace(<span class="hljs-string">&apos;L&apos;</span>,<span class="hljs-string">&apos;&apos;</span>)<br>    <span class="hljs-keyword">if</span> temp == <span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(string_mid,<span class="hljs-number">16</span>)^<span class="hljs-built_in">int</span>(tmp*k,<span class="hljs-number">16</span>)))):<br>    z = <span class="hljs-string">&quot;00&quot;</span> + z<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(z)%<span class="hljs-number">2</span> !=<span class="hljs-number">0</span>:<br>    z = <span class="hljs-string">&quot;0&quot;</span>+z<br>    <span class="hljs-comment">#print &quot;z:&quot;+z</span><br>    j = j-<span class="hljs-number">1</span><br>    k = k+<span class="hljs-number">1</span><br>    <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span>-<span class="hljs-number">1</span><br><span class="hljs-comment">#func(j,z)</span><br><br>client.close()<br></code></pre></td></tr></tbody></table></figure></body></html>
    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="../../../../tags/crypto/">#crypto</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="../../11/JavaScript-Prototype-Pollution-Attack/">JavaScript Prototype Pollution Attack</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="../../../10/04/%E5%BA%9F%E7%89%A9%E5%88%A9%E7%94%A8%E4%B9%8B%E5%88%A9%E7%94%A8%E4%B8%80%E5%8F%B0%E5%BA%9F%E5%BC%83%E7%AC%94%E8%AE%B0%E6%9C%AC%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BACTF%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%9F%BA%E7%A1%80%E5%BB%BA%E8%AE%BE/">废物利用之利用一台废弃笔记本快速搭建CTF实验室基础建设</a>
            
        </span>
    </div>
    
</article>




    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2020 ShuYu&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" target="_blank" rel="noopener" href="https://github.com/bkfish">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="../../../../js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '../../../../content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="../../../../js/insight.js"></script>

    
</body>
</html>